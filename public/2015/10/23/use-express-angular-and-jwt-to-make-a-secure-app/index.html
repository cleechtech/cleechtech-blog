<!DOCTYPE html>
<html>
<head>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-KNQM2VC');</script>
	<!-- End Google Tag Manager -->

	<title>Connor Leech</title>

	<!-- Meta -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Favicon -->
	<link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">

	<!-- Bootstrap -->
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
	
	<!-- Fonts -->
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

	<!-- Custom -->
	<link rel='stylesheet' href='css/theme.css'>
	<style>
	  .navbar-toggler {
	    z-index: 1;
	  }
	  @media (max-width: 576px) {
	    nav > .container {
	      width: 100%;
	    }
	  }
	  </style>
</head>
<body id='wrapper'>
	<!-- Navigation -->
<nav class="navbar fixed-top navbar-toggleable-md navbar-light is-fixed" id="mainNav">
  <div class="container">
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu <i class="fa fa-bars"></i>
    </button>
    <a class="navbar-brand page-scroll" href="/">Connor Leech</a>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
        	<a class="nav-link page-scroll" href="/blog">Blog</a>
        	<a class="nav-link page-scroll" href="/work">Work</a>
        	<a class="nav-link page-scroll" href="/about">About</a>
        	<a class="nav-link page-scroll" href="/contact">Contact</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
	<div class='container blog-post'>
	<div class='row'>
		<div class='col-sm-12'>
			<a href='/' class="btn btn-yellow btn-circle" style='color:grey;'>
            	<i class="fa fa-home fa-2"></i>
        	</a>
		</div>
	</div>
	<div class='row'>
		<h1 class='author-name'>use express, angular and jwt to make a secure app</h1>
	    October 23, 2015 
	    <hr />
		<p>Master authentication with fullstack javascript development<br><a id="more"></a></p>
<p><img src="http://media.giphy.com/media/3oEduWAFQjlfP5gMU0/giphy.gif" alt=""></p>
<p><a href="https://node-jwt-intro.herokuapp.com/" target="_blank" rel="external">DEMO</a></p>
<p><a href="https://github.com/jasonshark/node-jwt-intro" target="_blank" rel="external">SOURCE CODE</a></p>
<h3 id="Build-server"><a href="#Build-server" class="headerlink" title="Build server"></a>Build server</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="keyword">clone</span> <span class="title">https</span>://github.com/jasonshark/mean-starter</div></pre></td></tr></table></figure>
<p>Install some more packages:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm <span class="keyword">install </span><span class="keyword">jsonwebtoken </span><span class="keyword">bcrypt </span>q --save</div></pre></td></tr></table></figure>
<p>In <strong>server.js</strong> add a secret key. We will use the secret key to encrypt and decrypt the Json Web Tokens (JWTs).</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// JWT config</span></div><div class="line"><span class="keyword">var</span> jwtSecret = <span class="string">'thupers3crT$12'</span>;</div><div class="line">app.<span class="keyword">set</span>(<span class="string">'superSecret'</span>, jwtSecret);</div></pre></td></tr></table></figure>
<p>Create a user schema in <strong>server/models/user.js</strong>:</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> mongoose = <span class="keyword">require</span>(<span class="string">'mongoose'</span>);</div><div class="line"><span class="built_in">var</span> Schema = mongoose.Schema;</div><div class="line"></div><div class="line"><span class="comment">// email, pwd are required</span></div><div class="line"><span class="comment">// email must be unique</span></div><div class="line"><span class="comment">// don't send password with requests</span></div><div class="line"></div><div class="line"><span class="built_in">var</span> userSchema = <span class="literal">new</span> Schema(&#123;</div><div class="line">	email: &#123;<span class="keyword">type</span>: <span class="built_in">String</span>, required: <span class="literal">true</span>, unique: <span class="literal">true</span> &#125;,</div><div class="line">	password: &#123;<span class="keyword">type</span>: <span class="built_in">String</span>, required: <span class="literal">true</span>, <span class="keyword">select</span>: <span class="literal">false</span> &#125;,</div><div class="line">	admin: <span class="built_in">Boolean</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line">module.exports = mongoose.model(<span class="string">'User'</span>, userSchema);</div></pre></td></tr></table></figure>
<p>Like the comments say, email and passwords are required, emails must be unique and don’t send the password with the request. We are going to hash user passwords but it is still good practice to not expose that.</p>
<p><em>Hash password:</em> we are going to have a util for hashing and decrypting passwords. We will have these methods in <strong>server/utils.js</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> bcrypt = <span class="built_in">require</span>(<span class="string">'bcrypt'</span>),</div><div class="line">	q = <span class="built_in">require</span>(<span class="string">'q'</span>);</div><div class="line"></div><div class="line"><span class="comment">// helper function for hashing users' passwords</span></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">	<span class="attr">comparePwd</span>: <span class="function"><span class="keyword">function</span>(<span class="params">password, hash</span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> dfd = q.defer();</div><div class="line"></div><div class="line">		bcrypt.compare(password, hash, <span class="function"><span class="keyword">function</span>(<span class="params">err, isMatch</span>)</span>&#123;</div><div class="line">			<span class="keyword">if</span>(err) dfd.reject(err);</div><div class="line"></div><div class="line">			dfd.resolve(isMatch);</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		<span class="keyword">return</span> dfd.promise;</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">hashPwd</span>: <span class="function"><span class="keyword">function</span>(<span class="params">password</span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> dfd = q.defer();</div><div class="line">		bcrypt.genSalt(<span class="number">10</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, salt</span>) </span>&#123;</div><div class="line">			<span class="keyword">if</span>(err) dfd.reject(err);</div><div class="line"></div><div class="line">		    bcrypt.hash(password, salt, <span class="function"><span class="keyword">function</span>(<span class="params">err, hash</span>) </span>&#123;</div><div class="line">		    	<span class="keyword">if</span>(err) dfd.reject(err);</div><div class="line"></div><div class="line">		    	dfd.resolve(hash);</div><div class="line">		    &#125;);</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		<span class="keyword">return</span> dfd.promise;</div><div class="line">	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>set up routes in <strong>server/routes.js</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>),</div><div class="line">	path = <span class="built_in">require</span>(<span class="string">'path'</span>),</div><div class="line">	jwt = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>),</div><div class="line">	utils = <span class="built_in">require</span>(<span class="string">'./utils'</span>),</div><div class="line">	rootPath = path.normalize(__dirname + <span class="string">'/../'</span>),</div><div class="line">	apiRouter = express.Router(),</div><div class="line">	User = <span class="built_in">require</span>(<span class="string">'./models/user'</span>),</div><div class="line">	router = express.Router();</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app</span>)</span>&#123;	</div><div class="line">    ...</div></pre></td></tr></table></figure>
<p>Then make an api endpoint to add a user:</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// add user</span></div><div class="line">	apiRouter.post(<span class="string">'/users'</span>, <span class="function"><span class="keyword">function</span></span>(req, res)&#123;</div><div class="line"></div><div class="line">		utils.hashPwd(req.body.password).then(<span class="function"><span class="keyword">function</span></span>(hashedPwd)&#123;</div><div class="line"></div><div class="line">			<span class="keyword">var</span> <span class="keyword">new</span><span class="type">User</span> = <span class="keyword">new</span> <span class="type">User</span>(&#123;</div><div class="line">				email: <span class="type">req</span>.body.email,</div><div class="line">				password: <span class="type">hashedPwd</span>,</div><div class="line">				admin: <span class="type">false</span></div><div class="line">			&#125;);</div><div class="line"></div><div class="line">			<span class="keyword">new</span><span class="type">User</span>.save(<span class="function"><span class="keyword">function</span></span>(err)&#123;</div><div class="line">				<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</div><div class="line"></div><div class="line">				<span class="comment">// create token</span></div><div class="line">				<span class="keyword">var</span> token = jwt.sign(<span class="keyword">new</span><span class="type">User</span>, app.<span class="keyword">get</span>(<span class="string">'superSecret'</span>), &#123; expiresInminutes: <span class="type">1440 </span>&#125;);</div><div class="line"></div><div class="line">				<span class="keyword">new</span><span class="type">User</span>.password = undefined;</div><div class="line"></div><div class="line">				<span class="comment">// send token</span></div><div class="line">				res.json(&#123;</div><div class="line">					success: <span class="type">true</span>,</div><div class="line">					message: <span class="type"></span>'Successfully authenticated!<span class="string">',</span></div><div class="line">					token: token,</div><div class="line">					user: newUser</div><div class="line">				&#125;);</div><div class="line">			&#125;);</div><div class="line">		&#125;);</div><div class="line">		</div><div class="line">	&#125;);</div></pre></td></tr></table></figure>
<p>We create the user in the database, create a token and send that. Authenticate a user with this route:</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// authenticate user</span></div><div class="line">apiRouter.post(<span class="string">'/users/auth'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">// add back the password field for this query</span></div><div class="line">	<span class="keyword">var</span> query = User.findOne(&#123;</div><div class="line">		email: req.body.email</div><div class="line">	&#125;).select(<span class="string">'_id email +password'</span>);</div><div class="line"></div><div class="line">	query.exec(<span class="function"><span class="keyword">function</span><span class="params">(err, user)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</div><div class="line"></div><div class="line">		<span class="keyword">if</span>(!user)&#123;</div><div class="line">			res.json(&#123; success: <span class="literal">false</span>, message: <span class="string">'No user with that email'</span> &#125;);</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span>(user)&#123;</div><div class="line"></div><div class="line">			<span class="comment">// check password</span></div><div class="line">			utils.comparePwd(req.body.password, user.password).then(<span class="function"><span class="keyword">function</span><span class="params">(isMatch)</span></span>&#123;</div><div class="line">				<span class="keyword">if</span>(!isMatch)&#123;</div><div class="line">					res.json(&#123; success: <span class="literal">false</span>, message: <span class="string">'Wrong password'</span> &#125;);</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">					<span class="comment">// create token</span></div><div class="line">					<span class="keyword">var</span> token = jwt.sign(user, app.get(<span class="string">'superSecret'</span>), &#123; expiresInminutes: <span class="number">1440</span> &#125;);</div><div class="line"></div><div class="line">					user.password = <span class="literal">undefined</span>;</div><div class="line"></div><div class="line">					<span class="comment">// send token</span></div><div class="line">					res.json(&#123;</div><div class="line">						success: <span class="literal">true</span>,</div><div class="line">						message: <span class="string">'Successfully authenticated!'</span>,</div><div class="line">						token: token,</div><div class="line">						user: user</div><div class="line">					&#125;);</div><div class="line">				&#125;</div><div class="line">			&#125;);</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Then we’re going to have an endpoint to show all the users, but we are going to protect it with some middleware, namely an <code>authenticate</code> function.</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">apiRouter.get(<span class="string">'/users'</span>, authenticate, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span></span>&#123;</div><div class="line">		User.<span class="built_in">find</span>(&#123;&#125;, <span class="function"><span class="keyword">function</span><span class="params">(err, users)</span></span>&#123;</div><div class="line">			res.json(users);</div><div class="line">		&#125;);</div><div class="line">	&#125;);</div></pre></td></tr></table></figure>
<p>That function is defined as such:</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// middleware</span></div><div class="line">	function authenticate(req, res, next)&#123;</div><div class="line">	  <span class="keyword">var</span> <span class="keyword">token</span> = req.body.<span class="keyword">token</span> || req.<span class="keyword">query</span>.<span class="keyword">token</span> || req.headers['x-access-<span class="keyword">token</span>'];</div><div class="line"></div><div class="line">	  <span class="keyword">if</span> (<span class="keyword">token</span>) &#123;</div><div class="line"></div><div class="line">	  	<span class="comment">// verify token validity</span></div><div class="line">	    jwt.verify(<span class="keyword">token</span>, <span class="keyword">app</span>.<span class="built_in">get</span>('superSecret'), function(<span class="keyword">err</span>, decoded) &#123;      </div><div class="line">	      <span class="keyword">if</span> (<span class="keyword">err</span>) &#123;</div><div class="line">	        <span class="keyword">return</span> res.json(&#123; success: false, message: 'Failed to authenticate <span class="keyword">token</span>.' &#125;);    </div><div class="line">	      &#125; <span class="keyword">else</span> &#123;</div><div class="line">	        req.decoded = decoded;    </div><div class="line">	        next();</div><div class="line">	      &#125;</div><div class="line">	    &#125;);</div><div class="line"></div><div class="line">	  &#125; <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">	    <span class="keyword">return</span> res.status(403).send(&#123; </div><div class="line">	        success: false, </div><div class="line">	        message: '<span class="keyword">No</span> <span class="keyword">token</span> provided.' </div><div class="line">	    &#125;);</div><div class="line">	    </div><div class="line">	  &#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>That’s all the server setup. Next we will deploy the app to heroku.</p>
<h3 id="Deploy-to-heroku"><a href="#Deploy-to-heroku" class="headerlink" title="Deploy to heroku"></a>Deploy to heroku</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ heroku create &lt;app_name&gt;</div><div class="line">$ heroku config:<span class="builtin-name">set</span> <span class="attribute">NODE_ENV</span>=production</div><div class="line">$ heroku addons:create mongolab:sandbox </div><div class="line">$ heroku<span class="built_in"> config </span>| grep MONGOLAB_URI</div></pre></td></tr></table></figure>
<p>Add the mongolab uri to <strong>server/env.js</strong>. Then commit the change.<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> git push heroku master</span></div><div class="line"><span class="meta">$</span><span class="bash"> heroku ps:scale web=1</span></div></pre></td></tr></table></figure></p>
<h3 id="Build-client"><a href="#Build-client" class="headerlink" title="Build client"></a>Build client</h3><p>Include libraries in <strong>public/index.html</strong>. We are going to use <a href="https://github.com/formly-js/angular-formly" target="_blank" rel="external">angular-formly</a> to keep things fresh. It also means we write more javascript and less html. woohoo!</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- angular + router + bootstrap --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.15/angular-ui-router.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  </div><div class="line">  <span class="comment">&lt;!-- angular-formly + dependency --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/api-check/7.5.0/api-check.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/angular-formly/6.21.1/formly.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/angular-formly-templates-bootstrap/6.0.0/angular-formly-templates-bootstrap.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- our custom js --&gt;</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p><img src="http://media.giphy.com/media/QgpbrXUVhJqzm/giphy.gif" alt=""></p>
<p>Here is the module definition in <strong>public/js/app.js</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'jwtintro'</span>, [</div><div class="line">	<span class="string">'ui.router'</span>,</div><div class="line">	<span class="string">'formly'</span>,</div><div class="line">	<span class="string">'formlyBootstrap'</span></div><div class="line">], <span class="function"><span class="keyword">function</span><span class="params">($httpProvider)</span></span>&#123;</div><div class="line">	<span class="comment">// will add token to header of requests if token is present</span></div><div class="line">	$httpProvider.interceptors.push(<span class="string">'authInterceptor'</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.run(<span class="function"><span class="keyword">function</span><span class="params">($rootScope, auth)</span></span>&#123;</div><div class="line">	<span class="comment">// if the user's data is in local storage</span></div><div class="line">	<span class="comment">// show them as signed in</span></div><div class="line">	<span class="keyword">var</span> user = auth.getUser();</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(user)&#123;</div><div class="line">		$rootScope.user = JSON.parse(user);</div><div class="line">	&#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.constant(<span class="string">'API_URL'</span>, <span class="string">'api/'</span>);</div><div class="line"></div><div class="line">app.config(<span class="function"><span class="keyword">function</span><span class="params">($stateProvider, $urlRouterProvider)</span></span>&#123;</div><div class="line">	$stateProvider</div><div class="line">		.state(<span class="string">'home'</span>, &#123;</div><div class="line">			url: <span class="string">"/"</span>,</div><div class="line">			templateUrl: <span class="string">"templates/main.html"</span>,</div><div class="line">			controller: <span class="string">'MainCtrl'</span></div><div class="line">		&#125;)</div><div class="line">		.state(<span class="string">'auth'</span>, &#123;</div><div class="line">			<span class="keyword">abstract</span>: <span class="keyword">true</span>,</div><div class="line">			templateUrl: <span class="string">'templates/auth/main.html'</span></div><div class="line">		&#125;)</div><div class="line">		.state(<span class="string">'auth.login'</span>, &#123;</div><div class="line">			url: <span class="string">"/login"</span>,</div><div class="line">			templateUrl: <span class="string">"templates/auth/login.html"</span>,</div><div class="line">			controller: <span class="string">'LoginCtrl'</span></div><div class="line">		&#125;)</div><div class="line">		.state(<span class="string">'auth.register'</span>, &#123;</div><div class="line">			url: <span class="string">"/register"</span>,</div><div class="line">			templateUrl: <span class="string">"templates/auth/register.html"</span>,</div><div class="line">			controller: <span class="string">'RegisterCtrl'</span></div><div class="line">		&#125;);</div><div class="line"></div><div class="line">	$urlRouterProvider.otherwise(<span class="string">"/"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Bet you did not know that there is a third argument to module definitions. I did not. You like that nifty abstract state? Shit is cray. Alright moving on, controllers look like:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">app.controller(<span class="string">'LoginCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($rootScope, $scope, user, $state)</span></span>&#123;</div><div class="line">	$scope.userCreds = &#123;&#125;;</div><div class="line"></div><div class="line">	$scope.loginFields = [</div><div class="line">		&#123; </div><div class="line">			type: <span class="string">'input'</span>,</div><div class="line">			key: <span class="string">'email'</span>,</div><div class="line">			templateOptions: &#123;</div><div class="line">				label: <span class="string">'Email'</span>,</div><div class="line">				type: <span class="string">'email'</span>,</div><div class="line">				placeholder: <span class="string">'Valid email address'</span>,</div><div class="line">				required: <span class="keyword">true</span></div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		&#123; </div><div class="line">			type: <span class="string">'input'</span>,</div><div class="line">			key: <span class="string">'password'</span>,</div><div class="line">			templateOptions: &#123;</div><div class="line">				label: <span class="string">'Password'</span>,</div><div class="line">				type: <span class="string">'password'</span>,</div><div class="line">				placeholder: <span class="string">'Password'</span>,</div><div class="line">				required: <span class="keyword">true</span></div><div class="line">			&#125;</div><div class="line"></div><div class="line">		&#125;</div><div class="line">	];</div><div class="line"></div><div class="line">	$scope.login = <span class="function"><span class="keyword">function</span><span class="params">(userCreds)</span></span>&#123;</div><div class="line">		user.login(userCreds).then(<span class="function"><span class="keyword">function</span> <span class="title">success</span><span class="params">(res)</span></span>&#123;</div><div class="line">			<span class="comment">// if successful, log user in</span></div><div class="line">			<span class="keyword">if</span>(res.data.success)&#123;</div><div class="line">				$rootScope.user = res.data.user;</div><div class="line">				$state.go(<span class="string">'home'</span>);</div><div class="line">			&#125;	</div><div class="line">		&#125;, <span class="function"><span class="keyword">function</span> <span class="title">handleError</span><span class="params">(res)</span></span>&#123;</div><div class="line">			console.error(<span class="string">'Error: '</span> + JSON.stringify(res.data));</div><div class="line">		&#125;);</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	$scope.logout = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</div><div class="line">		$rootScope.user = <span class="keyword">null</span>;</div><div class="line">		user.logout();</div><div class="line"></div><div class="line">		<span class="comment">// hard page refresh</span></div><div class="line">		$state.go($state.current.name, $state.params, &#123; reload: <span class="keyword">true</span> &#125;);</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line">app.controller(<span class="string">'RegisterCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($rootScope, $scope, user, $state)</span></span>&#123;</div><div class="line">	$scope.newUser = &#123;&#125;;</div><div class="line"></div><div class="line">	$scope.registerFields = [</div><div class="line">		&#123; </div><div class="line">			type: <span class="string">'input'</span>,</div><div class="line">			key: <span class="string">'email'</span>,</div><div class="line">			templateOptions: &#123;</div><div class="line">				label: <span class="string">'Email'</span>,</div><div class="line">				type: <span class="string">'email'</span>,</div><div class="line">				placeholder: <span class="string">'Valid email address'</span>,</div><div class="line">				required: <span class="keyword">true</span></div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		&#123; </div><div class="line">			type: <span class="string">'input'</span>,</div><div class="line">			key: <span class="string">'password'</span>,</div><div class="line">			templateOptions: &#123;</div><div class="line">				label: <span class="string">'Password'</span>,</div><div class="line">				type: <span class="string">'password'</span>,</div><div class="line">				placeholder: <span class="string">'8 characters, number and special symbol'</span>,</div><div class="line">				required: <span class="keyword">true</span></div><div class="line">			&#125;,</div><div class="line">			validators: &#123;</div><div class="line">				checker: <span class="function"><span class="keyword">function</span><span class="params">($viewValue, $modelValue, scope)</span></span>&#123;</div><div class="line">					<span class="keyword">var</span> attemptedPwd = $viewValue || $modelValue;</div><div class="line"></div><div class="line">					<span class="keyword">var</span> REQUIRED_PATTERNS = [</div><div class="line">					    /\d+/,    <span class="comment">//numeric values</span></div><div class="line">					    /[a-z]+/, <span class="comment">//lowercase values</span></div><div class="line">					    /[A-Z]+/, <span class="comment">//uppercase values</span></div><div class="line">					    /\W+/,    <span class="comment">//special characters</span></div><div class="line">					    /^\S+$/   <span class="comment">//no whitespace allowed</span></div><div class="line">					];</div><div class="line">					<span class="keyword">var</span> status = <span class="keyword">true</span>;</div><div class="line">					angular.<span class="keyword">forEach</span>(REQUIRED_PATTERNS, <span class="function"><span class="keyword">function</span><span class="params">(pattern)</span> </span>&#123;</div><div class="line">						<span class="comment">// check that the attempted password passes all tests</span></div><div class="line">						status = status &amp;&amp; pattern.test(attemptedPwd);</div><div class="line">					&#125;);</div><div class="line"></div><div class="line">					<span class="comment">// must be at least eight characters</span></div><div class="line">					<span class="keyword">return</span> (status &amp;&amp; attemptedPwd.length &gt;= <span class="number">8</span>)? <span class="keyword">true</span> : <span class="keyword">false</span>;</div><div class="line">				&#125;</div><div class="line"></div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	];</div><div class="line"></div><div class="line">	$scope.register = <span class="function"><span class="keyword">function</span><span class="params">(newUser)</span></span>&#123;</div><div class="line">		user.register(newUser).then(<span class="function"><span class="keyword">function</span> <span class="title">success</span><span class="params">(res)</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(res.data.success)&#123;</div><div class="line">				$rootScope.user = res.data.user;</div><div class="line">				$state.go(<span class="string">'home'</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;, handleError);</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">handleError</span><span class="params">(res)</span></span>&#123;</div><div class="line">		alert(<span class="string">'Error: '</span> + res.data);</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>public/js/factories/auth.js</strong>:<br>Here we are going to store the user data and the token in the browser’s localStorage. We also define this funky httpInterceptor business. request is a special keyword. It acts similar to express middleware.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// stores and removes jwt and user data</span></div><div class="line"><span class="comment">// from browser's local storage </span></div><div class="line"></div><div class="line">app.factory(<span class="string">'auth'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$window</span>)</span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">var</span> store = $<span class="built_in">window</span>.localStorage;</div><div class="line">	<span class="keyword">var</span> key = <span class="string">'node-jwt-intro-auth-token'</span>;</div><div class="line">	<span class="keyword">var</span> userKey = <span class="string">'node-jwt-intro-user'</span>;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		<span class="attr">getToken</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="keyword">return</span> store.getItem(key);</div><div class="line">		&#125;,</div><div class="line">		<span class="attr">setToken</span>: <span class="function"><span class="keyword">function</span>(<span class="params">token</span>)</span>&#123;</div><div class="line">			<span class="keyword">if</span>(token)&#123;</div><div class="line">				store.setItem(key, token);</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				store.removeItem(key);</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		<span class="attr">getUser</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="keyword">return</span> store.getItem(userKey);</div><div class="line">		&#125;,</div><div class="line">		<span class="attr">setUser</span>: <span class="function"><span class="keyword">function</span>(<span class="params">user</span>)</span>&#123;</div><div class="line">			<span class="keyword">if</span>(user)&#123;</div><div class="line">				store.setItem(userKey, <span class="built_in">JSON</span>.stringify(user));</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				store.removeItem(userKey);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// if the user has logged in add a special header</span></div><div class="line">app.factory(<span class="string">'authInterceptor'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">auth</span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		<span class="attr">request</span>: <span class="function"><span class="keyword">function</span>(<span class="params">config</span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> token = auth.getToken();</div><div class="line">			<span class="keyword">if</span>(token)&#123;</div><div class="line">				<span class="comment">// add custom header to every request when user has token</span></div><div class="line">				config.headers = config.headers || &#123;&#125;;</div><div class="line">				config.headers[<span class="string">'x-access-token'</span>] = token;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> config;</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>In the user facory we will send requests for login, logout and register <strong>public/js/factories/user.js</strong>:</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">app.factory(<span class="string">'user'</span>, <span class="function"><span class="keyword">function</span><span class="params">($http, auth, API_URL)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		login: <span class="function"><span class="keyword">function</span><span class="params">(userCreds)</span></span>&#123;</div><div class="line">			<span class="keyword">return</span> $http.post(API_URL + <span class="string">'users/auth'</span>, &#123;</div><div class="line">				email: userCreds.email,</div><div class="line">				password: userCreds.password</div><div class="line">			&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</div><div class="line">				auth.setToken(res.<span class="keyword">data</span>.token);</div><div class="line">				auth.setUser(res.<span class="keyword">data</span>.user);</div><div class="line">				<span class="keyword">return</span> res;</div><div class="line">			&#125;);</div><div class="line">		&#125;,</div><div class="line">		register: <span class="function"><span class="keyword">function</span><span class="params">(newUser)</span></span>&#123;</div><div class="line">			// create user</div><div class="line">			<span class="keyword">return</span> $http.post(API_URL + <span class="string">'users'</span>, &#123;</div><div class="line">				email: newUser.email,</div><div class="line">				password: newUser.password</div><div class="line">			&#125;).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</div><div class="line">				// <span class="built_in">log</span> user <span class="keyword">in</span></div><div class="line">				auth.setToken(res.<span class="keyword">data</span>.token);</div><div class="line">				auth.setUser(res.<span class="keyword">data</span>.user);</div><div class="line">				<span class="keyword">return</span> res;</div><div class="line">			&#125;);</div><div class="line">		&#125;,</div><div class="line">		logout: <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</div><div class="line">			auth.setToken();</div><div class="line">			auth.setUser();</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Now for the templates. Here’s the abstract one in <strong>public/templates/auth/main.html</strong>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'text-center'</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn-group btn-group-justified"</span> <span class="attr">role</span>=<span class="string">"group"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"auth.login"</span> <span class="attr">ui-sref-active</span>=<span class="string">'active'</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">role</span>=<span class="string">"button"</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">ui-sref</span>=<span class="string">"auth.register"</span> <span class="attr">ui-sref-active</span>=<span class="string">'active'</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">role</span>=<span class="string">"button"</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">'col-sm-6 col-sm-offset-3'</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">ui-view</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>and then the login and register angular-formly layouts are minimal.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">'loginForm'</span> <span class="attr">ng-submit</span>=<span class="string">'login(userCreds)'</span> <span class="attr">novalidate</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">formly-form</span> <span class="attr">model</span>=<span class="string">'userCreds'</span> <span class="attr">fields</span>=<span class="string">'loginFields'</span> <span class="attr">form</span>=<span class="string">'loginForm'</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span> <span class="attr">class</span>=<span class="string">'btn btn-primary'</span> <span class="attr">ng-disabled</span>=<span class="string">"loginForm.$invalid"</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">formly-form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>and…</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>Create a new account<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">'registerForm'</span> <span class="attr">ng-submit</span>=<span class="string">'register(newUser)'</span> <span class="attr">novalidate</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">formly-form</span> <span class="attr">model</span>=<span class="string">'newUser'</span> <span class="attr">fields</span>=<span class="string">'registerFields'</span> <span class="attr">form</span>=<span class="string">'registerForm'</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">'submit'</span> <span class="attr">class</span>=<span class="string">'btn btn-success'</span> <span class="attr">ng-disabled</span>=<span class="string">"registerForm.$invalid"</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">formly-form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>That is pretty much it. It is worth noting any app can send these requests to this server. The server sends and validates tokens. The server does not need to maintain sessions. The browser’s localStorage is also really helpful with this examples. If you have questions <a href="https://twitter.com/cleechtech" target="_blank" rel="external">hit me up on twitter</a>.</p>

	</div>
</div>
	
</body>
</html>