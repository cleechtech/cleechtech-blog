<!DOCTYPE html>
<html>
<head>
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-KNQM2VC');</script>
	<!-- End Google Tag Manager -->

	<title>Connor Leech</title>

	<!-- Meta -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Favicon -->
	<link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">

	<!-- Fonts -->
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

	<!-- Bootstrap -->
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
	<link rel='stylesheet' href='css/readable.bootswatch.css'>
	<link rel='stylesheet' href='css/main.css'>

</head>
<body id='wrapper'>
	<div class='container blog-post'>
	<div class='row'>
		<div class='col-sm-12'>
			<a href='/' class="btn btn-yellow btn-circle" style='color:grey;'>
            	<i class="fa fa-home fa-2"></i>
        	</a>
		</div>
	</div>
	<div class='row'>
		<h1 class='author-name'>facebook auth with ionic and firebase</h1>
	    October 24, 2015 
	    <hr />
		<p>Starter code is <a href="https://github.com/jasonshark/ionic-firebase-auth-starter" target="_blank" rel="external">HERE</a></p>
<a id="more"></a>
<iframe src="https://ghbtns.com/github-btn.html?user=jasonshark&repo=ionic-firebase-auth-starter&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>

<iframe src="https://ghbtns.com/github-btn.html?user=jasonshark&repo=ionic-firebase-auth-starter&type=fork&count=true&size=large" frameborder="0" scrolling="0" width="158px" height="30px"></iframe>

<p><i>A mobile app template built with ionic framework.</i></p>
<h3 id="Generate-app"><a href="#Generate-app" class="headerlink" title="Generate app:"></a>Generate app:</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> $ npm install -g cordova ionic</span></div><div class="line"><span class="meta">$</span><span class="bash"> ionic start ionic-firebase-auth-starter sidemenu</span></div><div class="line"><span class="meta">$</span><span class="bash"> ionic platform add ios</span></div><div class="line"><span class="meta">$</span><span class="bash"> ionic platform add android</span></div><div class="line"><span class="meta">$</span><span class="bash"> ionic build ios</span></div><div class="line"><span class="meta">$</span><span class="bash"> ionic build android</span></div><div class="line"><span class="meta">$</span><span class="bash"> ionic <span class="built_in">emulate</span> ios</span></div><div class="line"><span class="meta">$</span><span class="bash"> ionic <span class="built_in">emulate</span> android</span></div></pre></td></tr></table></figure>
<p>For android you also must install the sdk:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> brew install android-sdk</span></div><div class="line"><span class="meta">$</span><span class="bash"> android</span></div><div class="line"><span class="meta">$</span><span class="bash"> android list targets</span></div><div class="line"><span class="meta">$</span><span class="bash"> android avd</span></div></pre></td></tr></table></figure></p>
<p>Then select the package and install it after agreeing to the license. I got a <code>Error: Please install Android target: &quot;android-22&quot;</code>. That’s the error installing the packages should get rid of.</p>
<h3 id="testing-the-facebook-login"><a href="#testing-the-facebook-login" class="headerlink" title="testing the facebook login"></a>testing the facebook login</h3><p>To test our app in the browser run <code>$ ionic serve</code></p>
<p>Normally if we were authenticating with facebook in the browser using angular.js and firebase we have a whole list of methods. Check out the <a href="https://www.firebase.com/docs/web/libraries/angular/api.html" target="_blank" rel="external">angularFire documentation</a>. For auth in the browser we could use <code>$authWithOAuthPopup</code> or <code>$authWithOAuthRedirect</code>. Those do not work for a mobile application.</p>
<p>Fortunately, there is a cordova extension for this that works. Check out the <a href="http://ngcordova.com/docs/plugins/oauth/" target="_blank" rel="external">ngCordova OAuth plugin</a>. The author of that plugin has a <a href="https://blog.nraboy.com/2015/03/sign-into-firebase-with-facebook-using-ionic-framework/" target="_blank" rel="external">legit tutorial</a>, that’s where I got the code.</p>
<p>That said, using the plugin we can’t test authentication in the web browser, we have to use the emulator. If you try to go <code>$ ionic serve</code> and then click login with facebook you’ll get an error in the console:</p>
<p><code>ERROR: Cannot authenticate via a web browser</code></p>
<p>So we’ll have to test that our authentication works with </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash"> ionic build ios</span></div><div class="line"><span class="meta">$</span><span class="bash"> ionic <span class="built_in">emulate</span> ios</span></div></pre></td></tr></table></figure>
<p>The emulator is slow but deal with it. For our other features we’ll test using <code>ionic serve</code> cause changes are reflected instantly.</p>
<h3 id="Start-building"><a href="#Start-building" class="headerlink" title="Start building"></a>Start building</h3><p>For all those notes we haven’t written any code. When the user first fires up our app I want to go to a login screen, then after they log in redirect them to the app.</p>
<p>We need to install dependencies. Ionic comes with bower as a package manager. Bower is for installing client side libraries. </p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">bower </span><span class="keyword">install </span>ngCordova firebase angularfire --save</div></pre></td></tr></table></figure>
<p>This installs these in <code>www/lib</code> as specified in the <code>.bowerrc</code> file. The <code>--save</code> flag makes them persistent (added to <code>bower.json</code>).</p>
<p>We have the client side dependencies, now load them into <code>www/index.html</code> like a boss.</p>
<p><img src="http://media.giphy.com/media/GPZJLuaiexcIg/giphy.gif" alt=""></p>
<p>Script tags look like whoa:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- ionic/angularjs js --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"lib/ionic/js/ionic.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"lib/ngCordova/dist/ng-cordova.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'lib/firebase/firebase.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'lib/angularfire/dist/angularfire.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/ng-cordova-oauth.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- cordova script (this will be a 404 during development) --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"cordova.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- your app's js --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/controllers.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Add-routes"><a href="#Add-routes" class="headerlink" title="Add routes"></a>Add routes</h3><p>Ionic uses <a href="https://github.com/angular-ui/ui-router/wiki" target="_blank" rel="external">angular ui-router</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Ionic Starter App</span></div><div class="line"><span class="comment">// ..comments..</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'starter'</span>, [</div><div class="line">  <span class="string">'ionic'</span>, </div><div class="line">  <span class="string">'ngCordova'</span>,</div><div class="line">  <span class="string">'firebase'</span></div><div class="line">]);</div><div class="line"></div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="comment">// more stuff</span></div><div class="line"><span class="comment">// ...</span></div><div class="line"></div><div class="line">.config(<span class="function"><span class="keyword">function</span><span class="params">($stateProvider, $urlRouterProvider)</span> </span>&#123;</div><div class="line">  $stateProvider</div><div class="line"></div><div class="line">  .state(<span class="string">'app'</span>, &#123;</div><div class="line">    url: <span class="string">"/app"</span>,</div><div class="line">    <span class="keyword">abstract</span>: <span class="keyword">true</span>,</div><div class="line">    templateUrl: <span class="string">"templates/menu.html"</span>,</div><div class="line">    controller: <span class="string">'AppCtrl'</span></div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  .state(<span class="string">'login'</span>, &#123;</div><div class="line">    url: <span class="string">'/login'</span>,</div><div class="line">    templateUrl: <span class="string">'templates/login.html'</span>,</div><div class="line">    controller: <span class="string">'AuthCtrl'</span></div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  .state(<span class="string">'app.search'</span>, &#123;</div><div class="line">    url: <span class="string">"/search"</span>,</div><div class="line">    views: &#123;</div><div class="line">      <span class="string">'menuContent'</span>: &#123;</div><div class="line">        templateUrl: <span class="string">"templates/search.html"</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  .state(<span class="string">'app.browse'</span>, &#123;</div><div class="line">    url: <span class="string">"/browse"</span>,</div><div class="line">    views: &#123;</div><div class="line">      <span class="string">'menuContent'</span>: &#123;</div><div class="line">        templateUrl: <span class="string">"templates/browse.html"</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  <span class="comment">// if none of the above states are matched, use this as the fallback</span></div><div class="line">  $urlRouterProvider.otherwise(<span class="string">'/login'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Cool. So in the app variable declaration we add ngCordova and firebase. Those modules come from the libraries we installed via bower. Then set up a login state to render a template when the user hits <code>/login</code> route. For the mobile app obviously there is no url bar. When we test using <code>$ ionic serve</code> you will see the urls, but not in device emulation mode. The default if no route matches is to go to the login template (that’s the last line of code).</p>
<p>Create the login template in <strong>www/templates/login.html</strong>. A whole bunch of stuff got generated using “sidemenu” in the beginning. It’s fine to delete code.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ion-view</span> <span class="attr">view-title</span>=<span class="string">"Sign-In"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">ion-content</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"padding"</span> <span class="attr">style</span>=<span class="string">'margin-top:80px;'</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"button button-block button-positive"</span> <span class="attr">ng-click</span>=<span class="string">"login()"</span>&gt;</span></div><div class="line">        Sign in with facebook</div><div class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ion-content</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ion-view</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Then there’s the auth controller, this is where all the work really gets done:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">.controller(<span class="string">'AuthCtrl'</span>, <span class="function"><span class="keyword">function</span><span class="params">($scope, $rootScope, $firebaseAuth, $cordovaOauth, $state)</span></span>&#123;</div><div class="line">  <span class="keyword">var</span> fb_app_id = <span class="string">'1416319645359452'</span>;</div><div class="line">  <span class="keyword">var</span> ref = <span class="keyword">new</span> Firebase(<span class="string">"http://giphy.firebaseio.com/"</span>);</div><div class="line">  <span class="keyword">var</span> auth = $firebaseAuth(ref);</div><div class="line">  $rootScope.user = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">  $scope.login = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">    $cordovaOauth.facebook(fb_app_id, [<span class="string">"email"</span>]).then(<span class="function"><span class="keyword">function</span><span class="params">(result)</span> </span>&#123;</div><div class="line">        auth.$authWithOAuthToken(<span class="string">"facebook"</span>, result.access_token).then(<span class="function"><span class="keyword">function</span><span class="params">(authData)</span> </span>&#123;</div><div class="line">            console.log(JSON.stringify(authData));</div><div class="line">            </div><div class="line">            $rootScope.user = authData;</div><div class="line">            $rootScope.$apply();</div><div class="line">            $state.go(<span class="string">'app.browse'</span>);</div><div class="line"></div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span><span class="params">(error)</span> </span>&#123;</div><div class="line">            console.error(<span class="string">"ERROR: "</span> + error);</div><div class="line">        &#125;);</div><div class="line">    &#125;, <span class="function"><span class="keyword">function</span><span class="params">(error)</span> </span>&#123;</div><div class="line">        console.log(<span class="string">"ERROR: "</span> + error);</div><div class="line">    &#125;);</div><div class="line">  &#125;;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>This little gem is largely taken from <a href="https://twitter.com/nraboy" target="_blank" rel="external">@nraboy</a>‘s <a href="https://blog.nraboy.com/2015/03/sign-into-firebase-with-facebook-using-ionic-framework/" target="_blank" rel="external">blog post</a>. There are definite ways to clean this up, but for now you can emulate, log in with facebook and then see the user’s credentials in the browse template:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">ion-view</span> <span class="attr">view-title</span>=<span class="string">"Browse"</span>&gt;</span></span></div><div class="line">  <span class="tag">&lt;<span class="name">ion-content</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Browse<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">pre</span></span><span class="template-variable">&#123;&#123;user | json&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="attr">pre</span>&gt;</span></span></div><div class="line">  <span class="tag">&lt;/<span class="name">ion-content</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ion-view</span>&gt;</span></div></pre></td></tr></table></figure>
<p>For the record those <code>ion-</code> html tags are angular.js directives. They make all the awesome ionic styling that we get for free.</p>
<h3 id="Facebook-setup"><a href="#Facebook-setup" class="headerlink" title="Facebook setup"></a>Facebook setup</h3><p>For all this to work we have to create a facebook app. The variable <code>fb_app_id</code> is my public app id. I also had to add those credentials to my firebase forge.</p>
<p><img src="/content/images/2015/06/Screen-Shot-2015-06-02-at-10-19-02-AM.png" alt=""></p>
<p>You get your credentials from <a href="https://developers.facebook.com/apps" target="_blank" rel="external">developers.facebook.com/apps</a>:</p>
<p><img src="/content/images/2015/06/Screen-Shot-2015-06-02-at-10-20-23-AM.png" alt=""></p>
<p>Make sure to go to <code>Settings &gt; Advanced</code> and add <code>http://localhost/callback</code> to “Valid OAuth redirect URIs”:</p>
<p><img src="/content/images/2015/06/Screen-Shot-2015-06-02-at-10-23-03-AM.png" alt=""></p>
<p>Now you have authentication with facebook started for a mobile app. Build something awesome.</p>
<p>Here is the <a href="https://github.com/jasonshark/ionic-firebase-auth-starter" target="_blank" rel="external">ionic-firebase-auth-starter</a> code.</p>
<iframe src="https://ghbtns.com/github-btn.html?user=jasonshark&repo=ionic-firebase-auth-starter&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>

<iframe src="https://ghbtns.com/github-btn.html?user=jasonshark&repo=ionic-firebase-auth-starter&type=fork&count=true&size=large" frameborder="0" scrolling="0" width="158px" height="30px"></iframe>


<p>Questions? Comments? hit me up on <a href="https://twitter.com/cleechtech" target="_blank" rel="external">twitter</a></p>
<p><img src="http://media.giphy.com/media/9uBX8yeCP2Lmg/giphy.gif" alt=""></p>

	</div>
</div>
	
</body>
</html>